(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{ujfh:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return b}));r("1t7P"),r("LW0h"),r("jwue"),r("vrRf"),r("lTEL"),r("z84I"),r("Ee2X"),r("ho0z"),r("daRM"),r("FtHn"),r("+KXO"),r("7x/C"),r("87if"),r("+oxZ"),r("kYxP"),r("Cm4o");var n=r("m3Bd"),o=r.n(n),i=r("VrFO"),s=r.n(i),a=r("Y9Ll"),u=r.n(a),c=r("KEM+"),p=r.n(c),_=r("pXBW"),d=r("k49u"),f=r("ZjLa"),h=r("Myq3"),m=r("EhiH"),l=r("/NU0");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){p()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y=[d.a.BadOauthToken,d.a.OauthTimestampException,d.a.BadAuthenticationData,d.a.AccessDeniedByBouncer],b=function(){function e(t,r){var n=this;s()(this,e),p()(this,"scribeRequest",(function(e){var t=e.response,r=e.error,i=o()(e,["error"]),s=new window.URL(i.url);if((!r&&t||(t={headers:{},body:"",status:r?r.status:500},r instanceof _.a))&&!n._shouldFilter(s)){n._flushResourceTimingBuffer();var a=Object(h.a)(n._buffer,(function(e){var t=e.request;return s.protocol===t.uri_scheme&&s.hostname===t.uri_host_name&&s.pathname===t.uri_path&&(s.query||"")===t.uri_query}));if(a){var u=n._buffer.indexOf(a);n._buffer[u]=n._updateEventWithRequestResponse(a,i,t,r)}else{var c=n._prepareEvent(i.url),p=c&&n._updateEventWithRequestResponse(c,i,t,r);p&&n._buffer.push(p)}n._flushBuffer()}})),p()(this,"_shouldFilter",(function(e){return e.pathname.indexOf("/1.1/jot")>-1})),p()(this,"_flushResourceTimingBuffer",(function(){if(n._resourceTimingApiSupported){var e=window.performance.getEntriesByType("resource");window.performance.clearResourceTimings(),e.forEach((function(e){if(e.name){var t=n._prepareEvent(e.name);if(t){var r=n._updateEventWithPrecisionTimings(t,e);n._buffer.push(r)}}}))}})),p()(this,"_updateNetworkInfo",(function(e){n._networkInfo=e})),p()(this,"_getNetworkMeasurements",(function(){return{connection_type:n._networkInfo.type||"unknown",speed_class:n._networkInfo.effectiveType,download_mbps:n._networkInfo.downlink,download_max_mbps:n._networkInfo.downlinkMax,rtt_ms:n._networkInfo.rtt,reduced_data_usage:n._networkInfo.saveData}})),this._resourceTimingApiSupported=window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("resource")&&window.performance.clearResourceTimings,this._scribe=t,this._options=w({apiErrorSampleSize:0,apiSampleSize:0,cdnSampleSize:0,cdnHostList:[]},r),this._buffer=[],this._networkInfo={},f.a.getConnectionInfo().then((function(e){n._updateNetworkInfo(e),f.a.addEventListener("connectionChange",n._updateNetworkInfo)})),this._resourceTimingApiSupported&&(window.performance.onresourcetimingbufferfull=this._flushResourceTimingBuffer)}return u()(e,[{key:"_record",value:function(e){this._sample(e)&&this._scribe.log(void 0,e)}},{key:"_possiblyRecordErrorToAllNamespace",value:function(e){if("api:error"===e.event_type){var t=w(w({},e),{},{event_type:"api:all"});this._record(t)}}},{key:"_flushBuffer",value:function(){var e=this;this._buffer.splice(0,this._buffer.length).forEach((function(t){e._record(t),e._possiblyRecordErrorToAllNamespace(t)}))}},{key:"_sample",value:function(e){var t=e.event_type,r=this._options[{"api:all":"apiSampleSize","api:error":"apiErrorSampleSize","cdn:all":"cdnSampleSize"}[t]]||0;return Math.random()<r}},{key:"_getEventType",value:function(e,t){return this._options.cdnHostList.indexOf(e)>-1?"cdn:all":e.indexOf("twitter.com")>-1?t>=200&&t<300?"api:all":"api:error":"none"}},{key:"_prepareEvent",value:function(e){var t=new window.URL(e);if(this._shouldFilter(t))return null;var r="api.twitter.com"===t.hostname;return{_category_:"client_network_request_event",request:{uri_scheme:t.protocol,uri_host_name:t.hostname,uri_path:t.pathname,uri_query:t.query||"",http_method:"GET",http_status_code:r?0:200,start_time_ms:Date.now(),request_details:{duration_ms:0}},common_header:{commonHeader:{clientHeader:{timestampMs:Date.now(),timezoneOffsetMin:-(new Date).getTimezoneOffset()}}},network_measurements:this._getNetworkMeasurements(),event_type:this._getEventType(t.hostname,200),event_source:"rweb"}}},{key:"_extractApiErrorCode",value:function(e){var t=e.errors,r=(void 0===t?[]:t).map((function(e){return e.code})).filter((function(e){return void 0!==e})),n=Object(m.a)(r,(function(e){return y.indexOf(e)>-1}));return n||(r.length>0?r[0]:void 0)}},{key:"_updateEventWithRequestResponse",value:function(e,t,r,n){var o=e.request.request_details;return w(w({},e),{},{request:w(w({},e.request),{},{http_method:t.method,http_status_code:r.status,start_time_ms:t.startTimestamp,trace_id:t.headers["x-b3-traceid"],twitter_api_error_code:n&&this._extractApiErrorCode(n)||void 0,request_details:w(w({},o),{},{duration_ms:o.duration_ms||t.endTimestamp-t.startTimestamp,request_body_size:o.request_body_size||("string"==typeof t.data?t.data.length:t.data?JSON.stringify(t.data).length:void 0),response_body_size:o.response_body_size||(r&&r.body?r.body.length:void 0)})}),event_type:this._getEventType(e.request.uri_host_name,r.status)})}},{key:"_getTiming",value:function(e,t){return Object(l.a)(e)&&Object(l.a)(t)?Math.round(t-e):void 0}},{key:"_updateEventWithPrecisionTimings",value:function(e,t){return w(w({},e),{},{request:w(w({},e.request),{},{request_details:w(w({},e.request.request_details),{},{duration_ms:Math.round(t.responseEnd-t.fetchStart),rx_bytes:t.transferSize,dns_ms:this._getTiming(t.domainLookupStart,t.domainLookupEnd),tcp_ms:this._getTiming(t.connectStart,t.connectEnd),tls_ms:0===t.secureConnectionStart?void 0:Math.round(t.connectEnd-t.secureConnectionStart),response_body_size:t.decodedBodySize})})})}}]),e}()}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web-legacy/bundle.NetworkInstrument.116fe4e5.js.map